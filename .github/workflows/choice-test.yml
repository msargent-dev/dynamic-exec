name: Choice Test Workflow
on:
  workflow_dispatch:
    inputs:
      deployment-type:
        type: choice
        description: "Type of deployment"
        options:
          - "general"
          - "bundle"
      general-repo:
        type: string
        description: "Repository to checkout for a general deployment. Required when 'general' deployment is picked, is ignored otherwise."
        default: ""
      general-branch:
        type: string
        description: "Branch to checkout for a general deployment. Required when 'general' deployment is picked, is ignored otherwise."
        default: ""
      general-command:
        type: string
        description: "Command to run for a general deployment. Required when 'general' deployment is picked, is ignored otherwise."
        default: ""
      bundle-command:
        type: string
        description: "Command to run for a bundle deployment. Required when 'bundle' deployment is picked, is ignored otherwise."
        default: ""

jobs:
  run-workflow:
    runs-on: ubuntu-latest  # Or choose an appropriate runner
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4  # This step checks out your repository.

      - name: Validate inputs
        run: |
          valid_input=true
          
          if [[ ${{ inputs.deployment-type }} == "general" ]]; then
            if [[ -z "${{ inputs.general-repo }}" ]]; then 
              echo "general-repo must be set when 'general' deployment is selected"
              valid_input=false
            fi
            if [[ -z "${{ inputs.general-branch }}" ]]; then 
              echo "general-branch must be set when 'general' deployment is selected"
              valid_input=false
            fi
            if [[ -z "${{ inputs.general-command }}" ]]; then 
              echo "general-command must be set when 'general' deployment is selected"
              valid_input=false
            fi
          elif [[ ${{ inputs.deployment-type }} == "bundle" ]]; then
            if [[ -z "${{ inputs.bundle-command }}" ]]; then 
              echo "bundle-command must be set when 'bundle' deployment is selected"
              valid_input=false
            fi
          fi
          
          if !$valid_input; then
            echo "Invalid inputs...exiting."
            exit 1
          fi
